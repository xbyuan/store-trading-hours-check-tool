var config={apiKey:"AIzaSyB4Qd3KdxiM23NFJ_qqWCyZlPZbHAkzezY",authDomain:"tgg-api.firebaseapp.com",databaseURL:"https://tgg-api.firebaseio.com",projectId:"tgg-api",storageBucket:"tgg-api.appspot.com",messagingSenderId:"539439185960"};firebase.initializeApp(config);var database=firebase.database();
$("#getStoreLocator").bind("input",function(){var a=$(this).val();$("#getStoreLocator").find("li");2<a.length?isNaN(a)&&""!=a?0<a.indexOf(" ")?(a=a.replace(/ /g,"_"),getPostcode(a)):getPostcode(a):isNaN(a)||""==a||getSuburbs(a):clearSuggList()});
$("#getStoreLocator").keyup(function(a){var b=$("#getStoreLocator").val(),g=$("#suggestionList").first().html(),c=$("#suggestionList").find("li.active"),h=0<$("#suggestionList").find("li").length?!0:!1;13===a.keyCode&&2<b.length?0===c.length&&h?(getStoresList(g),clearSuggList()):1===c.length&&h?(getStoresList(c),clearSuggList()):4==b.split(", ").pop().length||h?4!==b.split(", ").pop().length||h||queryStoreList(b.split(", ").pop()):displayAlert("invalidFormat"):13===a.keyCode&&2>=b.length&&displayAlert("invalidFormat")});
$(document).keydown(function(a){if(40==a.keyCode)if(0!=$("#suggestionList li.active").length){var b=$("#suggestionList").find("li.active").next();$("#suggestionList li.active").removeClass("active");b.focus().addClass("active")}else $("#suggestionList").find("li:first").focus().addClass("active");38==a.keyCode&&(0!=$("#suggestionList li.active").length?(b=$("#suggestionList").find("li.active").prev(),$("#suggestionList li.active").removeClass("active"),b.focus().addClass("active")):$("#suggestionList").find("li:first").focus().addClass("active"))});
$("#btn_search").click(function(a){a=$("#getStoreLocator").val();var b=0<$("#suggestionList").find("li").length?!0:!1;2<a.length?b?(a=$("#suggestionList").first().html(),getStoresList(a),clearSuggList()):(a=a.split(", ").pop(),4!==a.length||isNaN(a)?displayAlert("invalidFormat"):queryStoreList(a)):displayAlert("invalidFormat")});
function getSuburbs(a){var b=validPostcode(a);3===a.length&&b?firebase.database().ref("postcode-api/").orderByKey().startAt(a+"0").endAt(a+"9").limitToFirst(10).once("value").then(function(b){generateSuggestions(b.val(),a)}):4===a.length&&b?firebase.database().ref("postcode-api/"+a).once("value").then(function(b){generateSuggestions(b.val(),a)}):4<a.length&&displayError("Please enter a valid postcode or suburb.")}function validPostcode(a){a=parseInt(a);return 800>a||7799<a?!1:!0}
function getPostcode(a){a=a.toUpperCase();2<a.length&&firebase.database().ref("suburb-api/").orderByKey().startAt(a).endAt(a+"\uf8ff").limitToFirst(20).once("value").then(function(a){generateSuburbSuggestions(a.val())})}
function generateSuggestions(a,b){var g="",c=getState(b);clearSuggList();a&&($.isArray(a)?a.forEach(function(a){g+="<li class='sugg-list' data-state='"+c+"' data-suburb='"+a.suburb+"' data-postcode='"+b+"' onclick='getStoresList(this)'>"+a.suburb+", "+c+", "+b+"</li>"}):$.each(a,function(a,b){b.forEach(function(b){g+="<li class='sugg-list' data-state='"+c+"' data-suburb='"+b.suburb+"' data-postcode='"+a+"' onclick='getStoresList(this)'>"+b.suburb+", "+c+", "+a+"</li>"})}),$("#suggestionList").show().html(g))}
function generateSuburbSuggestions(a){var b="";a&&(clearSuggList(),$.each(a,function(a,c){c.forEach(function(c){var g=a.replace("_"," "),h=getState(c);b+="<li class='sugg-list' data-state='"+h+"'  data-suburb='"+a+"' data-postcode='"+c+"' onclick='getStoresList(this)'>"+g+", "+h+", "+c+"</li>"})}),$("#suggestionList").show().html(b))}
function getState(a){switch(a.charAt(0)){case "0":return"NT";case "2":return a=parseInt(a),2599<a&&2619>a||2899<a&&2921>a?"ACT":"NSW";case "3":return"VIC";case "4":return"QLD";case "5":return"SA";case "6":return"WA";case "7":return"TAS";default:return"Unknown"}}function showSpinner(){$("#searchSpinner").show();$("#quitStoreLocater").hide();clearError()}function hideSpinner(){$("#searchSpinner").hide();$("#quitStoreLocater").show()}function clearSuggList(){$("#suggestionList").hide().html("")}
function clearError(){$("#noStoreAlert").remove()}function getStoresList(a){var b=$(a).attr("data-suburb"),g=$(a).attr("data-postcode");a=$(a).attr("data-state");b=b.replace("_"," ");$("#getStoreLocator").val(b+", "+a+", "+g);clearSuggList();queryStoreList(g)}function queryStoreList(a){showSpinner();firebase.database().ref("store-api/"+a).once("value").then(function(a){fetchStoreTradingHours(a.val())})}
function fetchStoreTradingHours(a){var b=[],g=2;$("#noStoreAlert").remove();null===a?displayAlert("noStore"):a[0].name&&($.each(a,function(a,h){$.ajax({url:"https://tgg-api.firebaseio.com/store-detail-api/"+h.id+".json",type:"GET",dataType:"JSON",async:!1,success:function(c){void 0===c||null===c?g+=1:b[a]=c},error:function(a){console.log("Error:"+a)}});return a<g}),hideSpinner(),displayStores(b))}
function displayAlert(a){"noStore"===a?(hideDropDown(),hideSpinner(),$(".store-locater .clearfix.marg-top-5").parent().append("<div id='noStoreAlert' class='alert alert-danger marg-top-5 marg-bottom-0'>Sorry, no store can be found within 200 km of the search radius.</div>")):"invalidFormat"===a&&(clearSuggList(),hideDropDown(),clearError(),hideSpinner(),$(".store-locater .clearfix.marg-top-5").parent().append("<div id='noStoreAlert' class='alert alert-danger marg-top-5 marg-bottom-0'>Please type in a valid postcode or suburb.</div>"))}
function hideDropDown(){$("#desktop_tb").html("");$(".store-locater").removeClass("list-expand");$("#hoursBanner").hide();$("#errorContainer").hide()}
function displayStores(a){function b(a,b){return a.slice(b).concat(a.slice(0,b))}function g(a){var b;$.each(a,function(a,c){var e=c.date,f=moment().format("YYYY-MM-DD");e=moment(e).format("YYYY-MM-DD");if(moment(f).isSame(e))return b=c,!1});return b}function c(a){var b=[];$.each(a,function(a,c){var e=c.date,f=moment().subtract(1,"days").format("YYYY-MM-DD"),d=moment().add(7,"days").format("YYYY-MM-DD");e=moment(e).format("YYYY-MM-DD");moment(e).isBetween(f,d)&&b.push(c)});return 0<b.length?b:!1}function h(a,
b){var c=[];0<b.length&&$.each(b,function(b,c){$.each(a,function(b,d){d.day===c.day&&(a[b]=c)})});$.each(a,function(a,b){var e=b.event?b.event:"";c.push({time:"0"===b.open&&"0"===b.close?"<span class='text-secondary'>Closed</span>":b.open+"am - "+b.close+"pm",text:e,style:1<e.length?"bg-info-sat bg-lighten-4":""})});return c}var n=(new Date).getDay(),t="";0===n&&(n=7);var u=n-1;$.each(a,function(a,f){var k=moment();f.name.toLowerCase().replace(/ /g,"-");var m=g(f.exception),e=m?m:f.trading_hours[n],
v=m?"bg-info-sat bg-lighten-4 bg-transparent":"",d=c(f.exception);d=h(f.trading_hours,d);var l="Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");l=b(l,u);d=b(d,u);if("0"!=e.open&&"0"!=e.close){var p=e.open,q=e.close;var r=moment();p=moment(p,"HH:mm");q=moment(q,"HH:mm").add(12,"hours");console.log(p+"/"+q);r=r.isBetween(p,q)?"<div class='col-xs-3 padd-0'>Today </div><div class='col-xs-2 padd-0'>"+k.format("DD MMM.").toUpperCase()+"</div><div class='col-xs-7 hidden-nextdays padd-0 open-now' onclick='expandDays(this)'><span class='open-dot'></span>"+
e.open+"am - "+e.close+"pm<i class='fa fa-angle-down marg-left-5 text-info-sat'></i></div>":"<div class='col-xs-3 padd-0'>Today </div><div class='col-xs-2 padd-0'>"+k.format("DD MMM.").toUpperCase()+"</div><div class='col-xs-7 hidden-nextdays padd-0 closed-now' onclick='expandDays(this)'><span class='open-dot'></span>"+e.open+"am - "+e.close+"pm<i class='fa fa-angle-down marg-left-5 text-info-sat'></i></div>"}else r="<div class='col-xs-3 padd-0'>Today </div><div class='col-xs-2 padd-0'>"+k.format("DD MMM.").toUpperCase()+
"</div><div class='col-xs-7 hidden-nextdays closed-now text-secondary padd-0' onclick='expandDays(this)'><span class='open-dot'></span>Closed <i class='fa fa-angle-down marg-left-5 text-info-sat'></i></div>";m=m?"<div class='col-xs-12 padd-0 text-black text-medium'>"+e.event+"</div>":"";k="<section class='next-days-hours disp-none'><div class='clearfix padd-left-15 "+d[1].style+"'><div class='col-xs-12 text-black text-medium'>"+d[1].text+"</div><div class='col-xs-3'>"+l[1]+"</div><div class='col-xs-2'>"+
k.add(1,"days").format("DD MMM.").toUpperCase()+"</div><div class='col-xs-7'>"+d[1].time+"</div></div><div class='clearfix padd-left-15 "+d[2].style+"'><div class='col-xs-12 text-black text-medium'>"+d[2].text+"</div><div class='col-xs-3'>"+l[2]+"</div><div class='col-xs-2'>"+k.add(1,"days").format("DD MMM.").toUpperCase()+"</div><div class='col-xs-7'>"+d[2].time+"</div></div><div class='clearfix padd-left-15 "+d[3].style+"'><div class='col-xs-12 text-black text-medium'>"+d[3].text+"</div><div class='col-xs-3'>"+
l[3]+"</div><div class='col-xs-2'>"+k.add(1,"days").format("DD MMM.").toUpperCase()+"</div><div class='col-xs-7'>"+d[3].time+"</div></div><div class='clearfix padd-left-15 "+d[4].style+"'><div class='col-xs-12 text-black text-medium'>"+d[4].text+"</div><div class='col-xs-3'>"+l[4]+"</div><div class='col-xs-2'>"+k.add(1,"days").format("DD MMM.").toUpperCase()+"</div><div class='col-xs-7'>"+d[4].time+"</div></div><div class='clearfix padd-left-15 "+d[5].style+"'><div class='col-xs-12 text-black text-medium'>"+
d[5].text+"</div><div class='col-xs-3'>"+l[5]+"</div><div class='col-xs-2'>"+k.add(1,"days").format("DD MMM.").toUpperCase()+"</div><div class='col-xs-7'>"+d[5].time+"</div></div><div class='clearfix padd-left-15 "+d[6].style+"'><div class='col-xs-12 text-black text-medium'>"+d[6].text+"</div><div class='col-xs-3'>"+l[6]+"</div><div class='col-xs-2'>"+k.add(1,"days").format("DD MMM.").toUpperCase()+"</div><div class='col-xs-7'>"+d[6].time+"</div></div></section>";t+="<section class='hours-container'><h4 class='padd-left-15 marg-0 padd-10 text-black text-medium'>"+
f.name+("<i class='fa fa-info-circle text-info-sat text-size-85 marg-left-5' data-toggle='popover' data-html='true' data-trigger='hover' data-placement='top' title='' data-content='<p>Address: "+f.address+", "+f.state+", "+f.postcode+"</p><p>Contact: "+f.phone+"</p><p>"+f.email_address+"</p>' data-original-title='<b>"+f.name+" Store Details</b>'></i>")+"<span class='pull-right view-all text-info-sat text-size-75 text-light' onclick='expandDaysText(this)'>View all hours</span></h4><div class='clearfix padd-left-15 "+
v+"'>"+m+r+"</div>"+k+"</section>"});$("#desktop_tb").html("");$(".store-locater").addClass("list-expand");$("#hoursBanner").hide();$("#errorContainer").hide();$("#desktop_tb").html(t).slideDown();$("#quitStoreLocater").show();$(function(){$('[data-toggle="popover"]').popover({container:"body"})})}
$("#quitStoreLocater").click(function(){$("#desktop_tb").slideUp();$("#quitStoreLocater").hide();$(".store-locater").removeClass("list-expand");$("#hoursBanner").delay("1000").show();$("#noStoreAlert").remove();$("#getStoreLocator").val("");hideDropDown();clearSuggList()});
$(function(){expandDays=function(a){$(a).parent().next(".next-days-hours").slideToggle();$(a).find(".fa").hasClass("fa-angle-down")?($(a).find(".fa").removeClass("fa-angle-down").addClass("fa-angle-up"),$(a).parent().parent().children("h4").find(".view-all").text("View less hours"),$(a).parent().removeClass("bg-transparent")):($(a).find(".fa").removeClass("fa-angle-up").addClass("fa-angle-down"),$(a).parent().parent().children("h4").find(".view-all").text("View all hours"),$(a).parent().addClass("bg-transparent"))};
expandDaysText=function(a){$(a).parent().siblings(".next-days-hours").slideToggle();$(a).parent().siblings("div").find(".fa").hasClass("fa-angle-down")?($(a).parent().siblings("div").find(".fa").removeClass("fa-angle-down").addClass("fa-angle-up"),$(a).text("View less hours"),$(a).parent().siblings("div").removeClass("bg-transparent")):($(a).parent().siblings("div").find(".fa").removeClass("fa-angle-up").addClass("fa-angle-down"),$(a).text("View all hours"),$(a).parent().siblings("div").addClass("bg-transparent"))}});