<div class="ggds">
	<div class="container" id="storeLocator">
    <!-- BEGIN StoreLocator.jsp -->
    <script type="text/javascript" src="/cs/groups/public/documents/web_asset/store-locator-homepage-js.js"></script>
    <script type="text/javascript">
		var filePath = '//uatauthv8.thegoodguys.com.au/wcsstore/AUOnlineSAS/images/';	
	</script>
    <input type="hidden" id="fromPage" value="StoreLocator" autocomplete="off">
    <script type="text/javascript">
		dojo.addOnLoad(function() {	
		MessageHelper.setMessage("ERROR_NoSuburbFound", "No suburbs found. Please check and try again.");
		MessageHelper.setMessage("ERROR_POSTCODE_INVALID", "Please enter a valid postcode or suburb");
		MessageHelper.setMessage("ERROR_POSTCODE_EMPTY", "Please enter your postcode or suburb");
		MessageHelper.setMessage("ERROR_STARTPOINT_INVALID", "Please enter a valid start point");
		MessageHelper.setMessage("ERROR_STARTPOINT_EMPTY", "Please enter a start point");
		MessageHelper.setMessage("ERROR_NO_STORES_FOUND", "No store can be found within 200 km of the search radius");
		MessageHelper.setMessage("ERROR_LOCATION_NOT_SUPPORTED", "Use My Location is not supported by this browser");
		}); 
	</script>
	<script type="text/javascript">
		StoreLocatorControllersDeclarationJS.setCommonParameters('-1','900','30000','','');
		storeLocatorJS.setCommonParameters('-1','900','30000');
		StoreLocatorControllersDeclarationJS.setControllerURL('provinceSelectionsController','https://uatauthv8.thegoodguys.com.au/AjaxProvinceSelectionDisplayView?catalogId=30000&amp;langId=-1&amp;storeId=900');
		StoreLocatorControllersDeclarationJS.setControllerURL('citySelectionsController','https://uatauthv8.thegoodguys.com.au/AjaxCitySelectionDisplayView?catalogId=30000&amp;langId=-1&amp;storeId=900');
		StoreLocatorControllersDeclarationJS.setControllerURL('storeLocatorResultsController','https://uatauthv8.thegoodguys.com.au/AjaxStoreLocatorResultsView?catalogId=30000&amp;langId=-1&amp;storeId=900&amp;orderId=');
		StoreLocatorControllersDeclarationJS.setControllerURL('selectedStoreListController','https://uatauthv8.thegoodguys.com.au/AjaxSelectedStoreListView?fromPage=StoreLocator&amp;catalogId=30000&amp;langId=-1&amp;storeId=900&amp;orderId=');
		StoreLocatorContextsJS.setCommonParameters('-1','900','30000','','');
		
		
		
		MessageHelper.setMessage("MISSING_CITY", "Your selection is incomplete. You must select a Country, State/Province, and City to continue.");
		MessageHelper.setMessage("EXCEED_PHYSICAL_STORE_SIZE", "Your store list contains the maximum number of stores.  Please remove a store location from your store list before adding a new store location.");

		dojo.addOnLoad(function() { parseWidget("selectedStoreList"); } );
		dojo.addOnLoad(function() { parseWidget("provinceSelections"); } );
		dojo.addOnLoad(function() { parseWidget("citySelections"); } );
		dojo.addOnLoad(function() { parseWidget("storeLocatorResults"); } );
		//dojo.addOnLoad(storeLocatorJS.initProvinceSelections);
	</script>
	<section class="row">
		<div class="col-sm-8 padd-0 marg-bottom-15 marg-top-15"><img class="img-responsive hidden-xs" alt="Jamie Oliver Promotion" src="/cs/groups/public/documents/graphic/18-hb-jopromo-wk23.jpg" style="opacity: 1;"></div>
	    <div id="gift_registry_box" class="col-sm-4 marg-bottom-15 marg-top-15 padd-right-0">
	        <div id="errorContainer" class="alert alert-danger" style="display:none"></div>
	        <span id="selectedStoreList_ACCE_Label" class="spanacce">Your Store List</span>
	        <div class="gift_content store_content store-locater">
	            <input type="hidden" id="latitude" value="" autocomplete="off">
	            <input type="hidden" id="longitude" value="" autocomplete="off">
	            <div class="clearfix">
	            	<button id="quitStoreLocater" type="button" class="close disp-none" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
	                <h4 class="marg-0">STORE TRADING HOURS</h4>
	                <h6>Want to know what time your closest store is open to?</h6>
	                <div id="isGoogleJSloaded" style="display:none">false</div>
	                <div id="jfigDataHelper" style="display:none">gme-thegoodguys</div>
	                <div class="clearfix marg-top-10">
	                    <div class="search_wrap col-xs-8 padd-0">
	                        <div id="postCodeResultDiv" style="display: none; width: 97%; font-size:14px;overflow:auto;z-index: 10; background: none repeat scroll 0px 0px #FFFFFF; border: 1px solid #CCCCCC; position: absolute; margin-top: 32px;"></div>
	                        <input id="storeLocatorInput" onkeyup="if(event.keyCode==13){ storeLocatorJS.fetchStores(''); return false;}else{storeLocatorJS.fetchPostCodeData(this.value, '');return false;}" onfocus="this.value=''" class="form-control find_location" type="text" placeholder="Please enter postcode or suburb">
	                    </div>
	                    <div class="button_wrap col-xs-1">
	                        <button id="btn_search" class="btn btn-info" type="submit" value="SEARCH" onclick="storeLocatorJS.fetchStores('')">GO</button>
	                    </div>
	                </div>
	                <div class="clearfix marg-top-5">
	                	<a href="#storeLocator" onclick="javascript:storeLocatorJS.getLocation();">
	                		<i class="fa fa-map-marker text-info" aria-hidden="true"></i>
				           	<span class="instruction"> Use my current location</span>       		
						</a>
	                </div>
	            </div>
	        </div>
	       
	        <div dojotype="wc.widget.RefreshArea" class="dijitContentPane store_content_nullbgg_outter" id="storeLocatorResults" widgetid="storeLocatorResults" ariamessage="Store Result List Display Updated" arialiveid="ariaMessage" controllerid="storeLocatorResultsController" role="region" aria-labelledby="storeLocatorResults_ACCE_Label" lang="en"></div>
	        <div class="hours-banner marg-top-15" id="hoursBanner">
	        	<a href="/christmas-gift-guide" style="text-decoration: none;" onclick="dataLayer.push({'event': 'HPespot', 'TGGEventCategory': 'Homepage Espots', 'TGGEventAction': 'CTA Tile 5','TGGEventLabel':' Slider'})">
	        		<img class="img-responsive width-100 hidden-xs" alt="Christmas" src="/cs/groups/public/documents/graphic/18-hb-giftmas-1.jpg">
	        		<img class="img-responsive visible-xs" data-src="/cs/groups/public/documents/graphic/18-hb-giftmas-1-m.jpg" alt="Christmas">
	        	</a>
	        </div>
	    </div>
    </section>
	</div>
</div>
<style type="text/css">
	.store-locater {padding: 15px; border: 1px solid #ccc}
	.store-locater.list-expand {border-bottom: 0 none; padding-bottom: 0}
	#postCodeResultDiv > div {padding: 3px 8px; border-bottom: 1px solid #ccc; cursor: pointer}
	#postCodeResultDiv > div:last-child {border-bottom: 0 none}
	#postCodeResultDiv > div b {font-weight: 700}
	#desktop_tb.row {display: none; margin: 0}
	.srch-result-left td {display: none}
	.srch-result-left td.storename {display: block}
	.hours-container {
	    padding: 6px;
	    margin: 0 10px;
	    border-bottom: 1px solid #ccc;
	}
	.hours-container:nth-child(3) {
		border-bottom: 0 none;
	}
	.hours-container b {font-weight: 700}
	.gift_content .row {
		border: 1px solid #ccc;
		border-top: 0 none;
	}
	.ggds .popover {z-index: 9999}
	#postCodeResultDiv > div:hover {background-color: #ccc}
	.hours-banner  {
		transition: height 0.2s ease-out;
	}
	.store-locater .close {
		font-size: 2.5em;
		color: #41aaf2;
		opacity: 1;
		line-height: .6;
	}
	@media screen and (max-width: 767px){
		body {cursor: pointer}
		#storeLocatorInput::-webkit-input-placeholder {line-height: 18px}
	}
</style>
<script>
	
</script>
<script type="text/javascript">
	function fetchStoreTradingHours() {
		var nearbyStoreData = [];
		var storeJsonHtml  = document.getElementById('storeJson').innerHTML;	
		var storeLocations = eval('(' + storeJsonHtml + ')');
		var storeCount     = parseInt($("#storeListCount").html());
		var limit = 2;
		$("#noStoreAlert").remove();
		if (storeCount === 0){
			$(".store-locater").removeClass('list-expand');
			$("#hoursBanner").hide();
			$("#errorContainer").hide();
			$(".store-locater .clearfix.marg-top-5").append("<div id='noStoreAlert' class='alert alert-danger marg-top-15'>Sorry, no store can be found within 200 km of the search radius.</div>");
		} else if (storeLocations.locations[0].description && storeCount != 0) {
			$.each(storeLocations.locations, function(i, val){
				$.ajax({
					url: 'https://tgg-stores.firebaseio.com/' + storeLocations.locations[i].description + '.json',
					type: "GET",
					dataType: "JSON",
					async: false,
					success: function(res) {
						var resData = res;
						var obj = {};
						obj["storeName"] = storeLocations.locations[i].description;
						obj["hoursData"] = resData;
						if (resData === undefined || resData === null) {
							limit = limit + 1;
						} else {
							nearbyStoreData[i] = obj;
						}
					},
					error: function(xhr) {
						console.log("Error:" + xhr);
					}
				});
				return i<limit;
			});
			displayStores(nearbyStoreData);
		}
		
	}

	function displayStores(stores) {
		var getDate 		 = new Date();
		var dateToday 		 = getDate.getDay();
		var htmlInner		 = "";
		if (dateToday === 0) {
			dateToday = 7;
		}
		var dateToQuery = dateToday - 1;
		$.each(stores, function(n, value){
			if (value === undefined ||  value === null) {
				console.log("Can't find store");
			} else {
				var storeName 		 = value.storeName.toLowerCase();
				var convertedStoreName = storeName.replace(/ /g, '-');
				var tradingHourToday = value.hoursData[dateToday];
				var tradingHours     = value.hoursData.slice(1);
				console.log(value.hoursData);
				console.log(tradingHours);
				var tradingDates     = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
					tradingDates 	 = reOrderDate(tradingDates, dateToQuery);
					tradingHours 	 = reOrderDate(tradingHours, dateToQuery);
					console.log(tradingDates);
					console.log(tradingHours);
				var isOpenToday		 = (tradingHourToday.start != 0) && (tradingHourToday.end != 0) ? true : false;
				var startTimeOutput	 = sortStartTime(tradingHourToday.start);
				var endTimeOutput	 = sortEndTime(tradingHourToday.end);
				var hours			 = isOpenToday? ("<p>Open today: " + startTimeOutput + endTimeOutput) : ("<p class='text-secondary'>Close today");
				var popover			 = "<i class='fa fa-info-circle text-info-sat' data-toggle='popover' data-html='true' data-trigger='hover' data-placement='top' title='' data-content='<b>Trading Hours</b><table><tbody><tr><td>" + "Today" + "</td><td>" + sortStartTime(tradingHours[0].start) + sortEndTime(tradingHours[0].end) + " </td></tr><tr><td>" + "Tomorrow" + "</td><td>" + sortStartTime(tradingHours[1].start) + sortEndTime(tradingHours[1].end) + " </td></tr><tr><td>" + tradingDates[2] + "</td><td>" + sortStartTime(tradingHours[2].start) + sortEndTime(tradingHours[2].end) + " </td></tr><tr><td>" + tradingDates[3] + "</td><td>" + sortStartTime(tradingHours[3].start) + sortEndTime(tradingHours[3].end) + " </td></tr><tr><td>" + tradingDates[4] + "</td><td>" + sortStartTime(tradingHours[4].start) + sortEndTime(tradingHours[4].end) + " </td></tr><tr><td>" + tradingDates[5] + "</td><td>" + sortStartTime(tradingHours[5].start) + sortEndTime(tradingHours[5].end) + " </td></tr><tr><td>" + tradingDates[6] + "</td><td>" + sortStartTime(tradingHours[6].start) + sortEndTime(tradingHours[6].end) + " </td></tr></tbody></table>' data-original-title='" + value.storeName + " Store Details'></i>";
				var htmlToWrite		 = 	"<section class='hours-container'>" +
											"<b>" + value.storeName + "</b>" + popover +
											 hours + "</p>" +
											"<div class='clearfix'>" +
												"<a href='https://www.thegoodguys.com.au/" + convertedStoreName + "' target='_blank'>View Trading Hours</a>" +
												"<span> | </span>" +
												"<a href='https://www.thegoodguys.com.au/" + convertedStoreName + "' target='_blank'>Get directions</a>" +
											"</div>" +
										"</section>";
				htmlInner += htmlToWrite;
			}
		});
		$("#desktop_tb").html("");
		$(".store-locater").addClass('list-expand');
		$("#hoursBanner").hide();
		$("#errorContainer").hide();
		$("#desktop_tb").html(htmlInner).slideDown();
		$("#quitStoreLocater").show();
		$(function(){
			$('[data-toggle="popover"]').popover({container: 'body'});
		});
		function sortStartTime(time) {
			var h,
				m,
				result;
			if (time.length == 3) {
				h = time.slice(0, 1);
				m = time.slice(1, 3);
			} else if (time.length == 4) {
				h = parseInt(time.slice(0, 2)) % 12;
				m = time.slice(2, 4);
			} else if (time.length == 1) {
				return "Closed";
			}
			return [h, ":", m, "AM"].join('') + " - ";
		}
		function sortEndTime(time) {
			var h;
			if (time.length == 4) {
				h = parseInt(time.slice(0, 2)) % 12;
			} else if (time.length == 1) {
				return "";
			}
			return [h, ":", time.slice(2, 4), "PM"].join('');
		}
		function reOrderDate(data, index) {
			return data.slice(index).concat(data.slice(0, index));
		}
	}
	$("#quitStoreLocater").click(function() {
		$("#desktop_tb").slideUp();
		$("#quitStoreLocater").hide();
		$(".store-locater").removeClass('list-expand');
		$("#hoursBanner").delay("1000").show();
		$("#noStoreAlert").remove();
	});
</script>